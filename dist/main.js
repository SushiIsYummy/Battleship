/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/audio/audioUtils.js":(e,r,t)=>{t.r(r),t.d(r,{playExplosionSound:()=>o,playMissSound:()=>n});var a=t("./src/audio/boom.mp3"),l=t("./src/audio/miss-sound.mp3");function o(){let e=new Audio(a);e.volume=.2,e.play()}function n(){new Audio(l).play()}},"./src/data/ShipData.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=[{name:"carrier",length:5,orientation:null,row:null,col:null},{name:"battleship",length:4,orientation:null,row:null,col:null},{name:"cruiser",length:3,orientation:null,row:null,col:null},{name:"submarine",length:3,orientation:null,row:null,col:null},{name:"destroyer",length:2,orientation:null,row:null,col:null}]},"./src/js/DOM/addMarkerOnGameboard.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=function(e,r,t,a,l){let o=e.cellHitInfo(t,a),n=document.querySelector(`.${r}`).querySelector(`.cell[data-row="${t}"][data-col="${a}"]`);if(!1!==o){let e=function(){let e=20;const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width",`${e}`),r.setAttribute("height",`${e}`),r.classList.add("hit-marker");const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",""+e/2),t.setAttribute("cy",""+e/2),t.setAttribute("r",""+e/2),r.appendChild(t),r}();e.classList.add(l),n.appendChild(e)}}},"./src/js/DOM/createGameboardGrid.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=function(e,r,t){let a=e.getSize();console.log(r);let l=document.querySelector(`.${r}`);console.log(l);for(let e=0;e<a;e++)for(let r=0;r<a;r++){let a=document.createElement("div");a.classList.add("cell"),a.classList.add(t),a.dataset.row=e,a.dataset.col=r,l.appendChild(a)}}},"./src/js/DOM/renderShipsOnGameboard.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=function(e,r){const t=document.querySelector(`.${r}`),a=e.getSize(),l=e.getBoard();for(let e=0;e<a;e++)for(let r=0;r<a;r++){let a=l[e][r];if(null!==a){t.querySelector(`.cell[data-row="${e}"][data-col="${r}"]`).dataset.shipName=a.name}}}},"./src/js/factories/Gameboard.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=function(){let e=10,r=Array(e).fill().map((()=>Array(e).fill(null))),t=Array(e).fill().map((()=>Array(e).fill(!1))),a=[];return{receiveAttack(e,a){if(!1!==t[e][a])return;let l=r[e][a];null!==l?(l.hit(e,a),t[e][a]="hit"):t[e][a]="miss"},placeShip(t,l){if(function(t){const{length:a,row:l,col:o,orientation:n}=t;if("horizontal"===n&&o+a>e||"vertical"===n&&l+a>e)return!1;if("horizontal"===n){for(let e=0;e<a;e++)if(null!=r[l][o+e])return!1}else if("vertical"===n)for(let e=0;e<a;e++)if(null!=r[l+e][o])return!1;return!0}(l)){const{row:e,col:o,name:n,length:s,orientation:i}=l;if("horizontal"===i)for(let l=0;l<s;l++)r[e][o+l]=t,a.push(t);else if("vertical"===i)for(let l=0;l<s;l++)r[e+l][o]=t,a.push(t);return!0}return!1},allShipsSunk(){for(let e=0;e<a.length;e++)if(!a[e].isSunk())return!1;return!0},getSize:()=>e,getBoard:()=>r,getBoardHits:()=>JSON.parse(JSON.stringify(t)),cellHitInfo:(e,r)=>t[e][r],displayBoard(){console.table(r)}}}},"./src/js/factories/Player.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=function(e){let r=Array(e.getSize()).fill().map((()=>Array(e.getSize()).fill(!0)));return{gameboard:e,attack(e,t,a){if(this.hasAvailableHit(t,a)){e.gameboard.receiveAttack(t,a),r[t][a]=!1}},hasAvailableHit:(e,t)=>r[e][t],getRemainingAvailableHits(){let e=[];for(let t=0;t<r.length;t++)for(let a=0;a<r.length;a++)this.hasAvailableHit(t,a)&&e.push({row:t,col:a});return e}}}},"./src/js/factories/Ship.js":(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});const a=function(e,r){let t=0,a=[];return{name:e,length:r,hit(e,r){a.push({row:e,col:r}),t++},isSunk(){return t>=this.length},getPositions:()=>JSON.parse(JSON.stringify(a))}}},"./src/js/gameplay.js":(e,r,t)=>{t.r(r),t.d(r,{initializeGame:()=>f});var a=t("./src/js/DOM/createGameboardGrid.js"),l=t("./src/js/utils/gameboardUtils.js"),o=t("./src/js/DOM/renderShipsOnGameboard.js"),n=t("./src/js/DOM/addMarkerOnGameboard.js"),s=t("./src/js/factories/Gameboard.js"),i=t("./src/js/factories/Player.js"),c=t("./src/audio/audioUtils.js");const d=(0,s.default)(),u=(0,s.default)(),p={playerBoard:d,enemyBoard:u,player:(0,i.default)(d),enemy:(0,i.default)(u),currentPlayer:null,switchPlayer(){this.currentPlayer===this.player?this.currentPlayer=this.enemy:this.currentPlayer===this.enemy&&(this.currentPlayer=this.player)},gameOver:!1};function f(){Math.round(Math.random());p.currentPlayer=p.player,(0,a.default)(p.playerBoard,"player-board","player-cell"),(0,a.default)(p.enemyBoard,"enemy-board","enemy-cell"),(0,l.placeShipsRandomly)(p.playerBoard),(0,l.placeShipsRandomly)(p.enemyBoard),(0,o.default)(p.playerBoard,"player-board"),function(){const e=document.querySelector(".enemy-board");e.addEventListener("click",(e=>{if(y())return void console.log("GAME IS OVER!!!");let r=e.target;if(r.classList.contains("enemy-cell")){let e=Number(r.dataset.row),t=Number(r.dataset.col);if(console.log(`available hit: ${p.player.hasAvailableHit(e,t)}`),console.log(p.currentPlayer===p.player),p.currentPlayer===p.player&&!p.gameOver&&p.player.hasAvailableHit(e,t))if(console.log(e,t),p.player.attack(p.enemy,e,t),"hit"===p.enemyBoard.cellHitInfo(e,t)){(0,c.playExplosionSound)(),(0,n.default)(p.enemyBoard,"enemy-board",e,t,"hit");let r=p.enemyBoard.getBoard()[e][t];if(console.log(r),r.isSunk()&&function(e){let r=e.getPositions();for(let t=0;t<r.length;t++){console.log(r[t].row,r[t].col),document.querySelector(`.enemy-cell[data-row="${r[t].row}"][data-col="${r[t].col}"]`).dataset.shipName=e.name}}(r),y())return void console.log("GAME IS OVER!!!")}else"miss"===p.enemyBoard.cellHitInfo(e,t)&&((0,c.playMissSound)(),(0,n.default)(p.enemyBoard,"enemy-board",e,t,"miss"),m(),p.switchPlayer())}}))}(),p.playerBoard.displayBoard(),console.table(p.enemyBoard.getBoardHits()),console.table(p.enemyBoard.displayBoard()),console.table(p.enemyBoard.getBoardHits())}function m(){let e=p.enemy.getRemainingAvailableHits(),r=Math.floor(Math.random()*e.length);console.log(r),console.log(e);let{row:t,col:a}=e.splice(r,1)[0];p.enemy.attack(p.player,t,a),"hit"===p.playerBoard.cellHitInfo(t,a)?((0,n.default)(p.playerBoard,"player-board",t,a,"hit"),(0,c.playExplosionSound)(),console.log("ENEMY HIT!"),m()):"miss"===p.playerBoard.cellHitInfo(t,a)&&(console.log("ENEMY MISS!"),(0,c.playMissSound)(),(0,n.default)(p.playerBoard,"player-board",t,a,"miss"),p.switchPlayer()),console.log("ENEMY ATTACK!")}function y(){return p.playerBoard.allShipsSunk()||p.enemyBoard.allShipsSunk()}},"./src/js/utils/gameboardUtils.js":(e,r,t)=>{t.r(r),t.d(r,{addHitMarker:()=>n,addMissMarker:()=>s,placeShipsRandomly:()=>o});var a=t("./src/data/ShipData.js"),l=t("./src/js/factories/Ship.js");function o(e){a.default.forEach((r=>{let t=(0,l.default)(r.name,r.length),a={...r};do{let r=Math.floor(Math.random()*(e.getSize()-0)+0),t=Math.floor(Math.random()*(e.getSize()-0)+0),l=Math.round(Math.random())?"horizontal":"vertical";a.row=r,a.col=t,a.orientation=l,console.log(a)}while(!0!==e.placeShip(t,a))}))}function n(e,r,t){}function s(e,r,t){}},"./src/css/styles.css":(e,r,t)=>{t.r(r)},"./src/audio/boom.mp3":(e,r,t)=>{e.exports=t.p+"b9c69bc988aeb9bf35ca.mp3"},"./src/audio/miss-sound.mp3":(e,r,t)=>{e.exports=t.p+"74280d6f23dc4aa34b60.mp3"}},r={};function t(a){var l=r[a];if(void 0!==l)return l.exports;var o=r[a]={exports:{}};return e[a](o,o.exports,t),o.exports}t.d=(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var r=t.g.document;if(!e&&r&&(r.currentScript&&(e=r.currentScript.src),!e)){var a=r.getElementsByTagName("script");if(a.length)for(var l=a.length-1;l>-1&&!e;)e=a[l--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();var a={};(()=>{t.r(a);t("./src/js/DOM/addMarkerOnGameboard.js"),t("./src/js/DOM/createGameboardGrid.js"),t("./src/js/DOM/renderShipsOnGameboard.js"),t("./src/js/factories/Gameboard.js"),t("./src/js/factories/Player.js"),t("./src/js/factories/Ship.js");var e=t("./src/js/gameplay.js");t("./src/js/utils/gameboardUtils.js"),t("./src/css/styles.css");(0,e.initializeGame)()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoiOytMQUVPLFNBQVNBLElBQ2QsSUFBSUMsRUFBUSxJQUFJQyxNQUFNQyxHQUN0QkYsRUFBTUcsT0FBUyxHQUNmSCxFQUFNSSxNQUNSLENBQ08sU0FBU0MsSUFDRixJQUFJSixNQUFNSyxHQUVoQkYsTUFDUixvRUNYQSxNQXNDQSxFQXRDaUIsQ0FDZixDQUNFRyxLQUFNLFVBQ05DLE9BQVEsRUFDUkMsWUFBYSxLQUNiQyxJQUFLLEtBQ0xDLElBQUssTUFFUCxDQUNFSixLQUFNLGFBQ05DLE9BQVEsRUFDUkMsWUFBYSxLQUNiQyxJQUFLLEtBQ0xDLElBQUssTUFFUCxDQUNFSixLQUFNLFVBQ05DLE9BQVEsRUFDUkMsWUFBYSxLQUNiQyxJQUFLLEtBQ0xDLElBQUssTUFFUCxDQUNFSixLQUFNLFlBQ05DLE9BQVEsRUFDUkMsWUFBYSxLQUNiQyxJQUFLLEtBQ0xDLElBQUssTUFFUCxDQUNFSixLQUFNLFlBQ05DLE9BQVEsRUFDUkMsWUFBYSxLQUNiQyxJQUFLLEtBQ0xDLElBQUssdUZDSlQsUUE5QkEsU0FBbUJDLEVBQVdDLEVBQWdCSCxFQUFLQyxFQUFLRyxHQUN0RCxJQUFJQyxFQUFVSCxFQUFVSSxZQUFZTixFQUFLQyxHQUVyQ00sRUFEZUMsU0FBU0MsY0FBZSxJQUFHTixLQUNuQk0sY0FBZSxtQkFBa0JULGlCQUFtQkMsT0FDL0UsSUFBZ0IsSUFBWkksRUFBbUIsQ0FDckIsSUFBSUssRUFNUixXQUVFLElBQUlDLEVBQU8sR0FDWCxNQUFNQyxFQUFNSixTQUFTSyxnQkFBZ0IsNkJBQThCLE9BQ25FRCxFQUFJRSxhQUFhLFFBQVUsR0FBRUgsS0FDN0JDLEVBQUlFLGFBQWEsU0FBVyxHQUFFSCxLQUM5QkMsRUFBSUcsVUFBVUMsSUFBSSxjQUdsQixNQUFNQyxFQUFTVCxTQUFTSyxnQkFBZ0IsNkJBQThCLFVBT3RFLE9BTkFJLEVBQU9ILGFBQWEsS0FBTyxHQUFFSCxFQUFPLEdBQ3BDTSxFQUFPSCxhQUFhLEtBQU8sR0FBRUgsRUFBTyxHQUNwQ00sRUFBT0gsYUFBYSxJQUFNLEdBQUVILEVBQU8sR0FHbkNDLEVBQUlNLFlBQVlELEdBQ1RMLENBQ1QsQ0F2Qm9CTyxHQUNoQlQsRUFBVUssVUFBVUMsSUFBSVosR0FDeEJHLEVBQVFXLFlBQVlSLEVBQ3RCLENBQ0YsaUZDUUEsUUFqQkEsU0FBNkJSLEVBQVdDLEVBQWdCaUIsR0FDdEQsSUFBSUMsRUFBZ0JuQixFQUFVb0IsVUFDOUJDLFFBQVFDLElBQUlyQixHQUNaLElBQUlzQixFQUFvQmpCLFNBQVNDLGNBQWUsSUFBR04sS0FDbkRvQixRQUFRQyxJQUFJQyxHQUNaLElBQUssSUFBSXpCLEVBQU0sRUFBR0EsRUFBTXFCLEVBQWVyQixJQUNyQyxJQUFLLElBQUlDLEVBQU0sRUFBR0EsRUFBTW9CLEVBQWVwQixJQUFPLENBQzVDLElBQUl5QixFQUFPbEIsU0FBU21CLGNBQWMsT0FDbENELEVBQUtYLFVBQVVDLElBQUksUUFDbkJVLEVBQUtYLFVBQVVDLElBQUlJLEdBQ25CTSxFQUFLRSxRQUFRNUIsSUFBTUEsRUFDbkIwQixFQUFLRSxRQUFRM0IsSUFBTUEsRUFDbkJ3QixFQUFrQlAsWUFBWVEsRUFDaEMsQ0FFSixvRkNDQSxRQWhCQSxTQUFnQ3hCLEVBQVdDLEdBQ3pDLE1BQU1zQixFQUFvQmpCLFNBQVNDLGNBQWUsSUFBR04sS0FFL0NrQixFQUFnQm5CLEVBQVVvQixVQUMxQk8sRUFBUTNCLEVBQVU0QixXQUN4QixJQUFLLElBQUk5QixFQUFNLEVBQUdBLEVBQU1xQixFQUFlckIsSUFDckMsSUFBSyxJQUFJQyxFQUFNLEVBQUdBLEVBQU1vQixFQUFlcEIsSUFBTyxDQUM1QyxJQUFJOEIsRUFBT0YsRUFBTTdCLEdBQUtDLEdBQ3RCLEdBQWEsT0FBVDhCLEVBQWUsQ0FDSE4sRUFBa0JoQixjQUFlLG1CQUFrQlQsaUJBQW1CQyxPQUM1RTJCLFFBQVFJLFNBQVdELEVBQUtsQyxJQUNsQyxDQUNGLENBRUosNkVDb0ZBLFFBbEdBLFdBQ0UsSUFBSW9DLEVBQVksR0FDWkosRUFBUUssTUFBTUQsR0FDZkUsT0FDQUMsS0FBSSxJQUFNRixNQUFNRCxHQUFXRSxLQUFLLFFBRS9CRSxFQUFZSCxNQUFNRCxHQUNuQkUsT0FDQUMsS0FBSSxJQUFNRixNQUFNRCxHQUFXRSxNQUFLLEtBQy9CRyxFQUFRLEdBMkJaLE1BQU8sQ0FDTEMsYUFBQUEsQ0FBY3ZDLEVBQUtDLEdBQ2pCLElBQTRCLElBQXhCb0MsRUFBVXJDLEdBQUtDLEdBQ2pCLE9BRUYsSUFBSThCLEVBQU9GLEVBQU03QixHQUFLQyxHQUNULE9BQVQ4QixHQUNGQSxFQUFLUyxJQUFJeEMsRUFBS0MsR0FDZG9DLEVBQVVyQyxHQUFLQyxHQUFPLE9BRXRCb0MsRUFBVXJDLEdBQUtDLEdBQU8sTUFFMUIsRUFDQXdDLFNBQUFBLENBQVVWLEVBQU1XLEdBQ2QsR0F2Q0osU0FBOEJBLEdBQzVCLE1BQU0sT0FBRTVDLEVBQU0sSUFBRUUsRUFBRyxJQUFFQyxFQUFHLFlBQUVGLEdBQWdCMkMsRUFFMUMsR0FBcUIsZUFBaEIzQyxHQUFnQ0UsRUFBTUgsRUFBU21DLEdBQStCLGFBQWhCbEMsR0FBOEJDLEVBQU1GLEVBQVNtQyxFQUM5RyxPQUFPLEVBSVQsR0FBb0IsZUFBaEJsQyxHQUNGLElBQUssSUFBSTRDLEVBQUksRUFBR0EsRUFBSTdDLEVBQVE2QyxJQUMxQixHQUEyQixNQUF2QmQsRUFBTTdCLEdBQUtDLEVBQU0wQyxHQUNuQixPQUFPLE9BR04sR0FBb0IsYUFBaEI1QyxFQUNULElBQUssSUFBSTRDLEVBQUksRUFBR0EsRUFBSTdDLEVBQVE2QyxJQUMxQixHQUEyQixNQUF2QmQsRUFBTTdCLEVBQU0yQyxHQUFHMUMsR0FDakIsT0FBTyxFQUtiLE9BQU8sQ0FDVCxDQWdCUTJDLENBQXFCRixHQUFXLENBQ2xDLE1BQU0sSUFBRTFDLEVBQUcsSUFBRUMsRUFBRyxLQUFFSixFQUFJLE9BQUVDLEVBQU0sWUFBRUMsR0FBZ0IyQyxFQUVoRCxHQUFvQixlQUFoQjNDLEVBQ0YsSUFBSyxJQUFJNEMsRUFBSSxFQUFHQSxFQUFJN0MsRUFBUTZDLElBQzFCZCxFQUFNN0IsR0FBS0MsRUFBTTBDLEdBQUtaLEVBQ3RCTyxFQUFNTyxLQUFLZCxRQUVSLEdBQW9CLGFBQWhCaEMsRUFDVCxJQUFLLElBQUk0QyxFQUFJLEVBQUdBLEVBQUk3QyxFQUFRNkMsSUFDMUJkLEVBQU03QixFQUFNMkMsR0FBRzFDLEdBQU84QixFQUN0Qk8sRUFBTU8sS0FBS2QsR0FHZixPQUFPLENBQ1QsQ0FDQSxPQUFPLENBQ1QsRUFDQWUsWUFBQUEsR0FDRSxJQUFLLElBQUlILEVBQUksRUFBR0EsRUFBSUwsRUFBTXhDLE9BQVE2QyxJQUNoQyxJQUFLTCxFQUFNSyxHQUFHSSxTQUNaLE9BQU8sRUFHWCxPQUFPLENBQ1QsRUFJQXpCLFFBQU9BLElBQ0VXLEVBRVRILFNBQVFBLElBRUNELEVBRVRtQixhQUFZQSxJQUNIQyxLQUFLQyxNQUFNRCxLQUFLRSxVQUFVZCxJQUVuQy9CLFlBQVdBLENBQUNOLEVBQUtDLElBQ1JvQyxFQUFVckMsR0FBS0MsR0FFeEJtRCxZQUFBQSxHQUNFN0IsUUFBUThCLE1BQU14QixFQUNoQixFQUVKLDBFQ25FQSxRQTdCQSxTQUFnQjNCLEdBQ2QsSUFBSW9ELEVBQWdCcEIsTUFBTWhDLEVBQVVvQixXQUNqQ2EsT0FDQUMsS0FBSSxJQUFNRixNQUFNaEMsRUFBVW9CLFdBQVdhLE1BQUssS0FFN0MsTUFBTyxDQUNMakMsWUFDQXFELE1BQUFBLENBQU9DLEVBQVF4RCxFQUFLQyxHQUNsQixHQUFJd0QsS0FBS0MsZ0JBQWdCMUQsRUFBS0MsR0FBTSxDQUNidUQsRUFBT3RELFVBQ2JxQyxjQUFjdkMsRUFBS0MsR0FDbENxRCxFQUFjdEQsR0FBS0MsSUFBTyxDQUM1QixDQUNGLEVBQ0F5RCxnQkFBZUEsQ0FBQzFELEVBQUtDLElBQ1pxRCxFQUFjdEQsR0FBS0MsR0FFNUIwRCx5QkFBQUEsR0FDRSxJQUFJQyxFQUFnQixHQUNwQixJQUFLLElBQUk1RCxFQUFNLEVBQUdBLEVBQU1zRCxFQUFjeEQsT0FBUUUsSUFDNUMsSUFBSyxJQUFJQyxFQUFNLEVBQUdBLEVBQU1xRCxFQUFjeEQsT0FBUUcsSUFDeEN3RCxLQUFLQyxnQkFBZ0IxRCxFQUFLQyxJQUFNMkQsRUFBY2YsS0FBSyxDQUFFN0MsTUFBS0MsUUFHbEUsT0FBTzJELENBQ1QsRUFFSix3RUNMQSxRQXRCQSxTQUFjL0QsRUFBTUMsR0FDbEIsSUFBSStELEVBQU8sRUFDUEMsRUFBWSxHQUNoQixNQUFPLENBQ0xqRSxPQUNBQyxTQUNBMEMsR0FBQUEsQ0FBSXhDLEVBQUtDLEdBQ1A2RCxFQUFVakIsS0FBSyxDQUFFN0MsTUFBS0MsUUFDdEI0RCxHQUNGLEVBQ0FkLE1BQUFBLEdBQ0UsT0FBSWMsR0FBUUosS0FBSzNELE1BSW5CLEVBQ0FpRSxhQUFZQSxJQUNIZCxLQUFLQyxNQUFNRCxLQUFLRSxVQUFVVyxJQUd2QyxzV0NaQSxNQUFNRSxHQUFjQyxFQUFBQSxFQUFBQSxXQUNkQyxHQUFhRCxFQUFBQSxFQUFBQSxXQUtiRSxFQUFZLENBQ2hCSCxZQUFhQSxFQUNiRSxXQUFZQSxFQUNaVixRQU5hWSxFQUFBQSxFQUFBQSxTQUFPSixHQU9wQkssT0FOWUQsRUFBQUEsRUFBQUEsU0FBT0YsR0FPbkJJLGNBQWUsS0FDZkMsWUFBQUEsR0FDTWQsS0FBS2EsZ0JBQWtCYixLQUFLRCxPQUM5QkMsS0FBS2EsY0FBZ0JiLEtBQUtZLE1BQ2pCWixLQUFLYSxnQkFBa0JiLEtBQUtZLFFBQ3JDWixLQUFLYSxjQUFnQmIsS0FBS0QsT0FFOUIsRUFDQWdCLFVBQVUsR0FHTCxTQUFTQyxJQUNFQyxLQUFLQyxNQUFNRCxLQUFLRSxVQUNoQ1QsRUFBVUcsY0FBZ0JILEVBQVVYLFFBTXBDcUIsRUFBQUEsRUFBQUEsU0FBb0JWLEVBQVVILFlBQWEsZUFBZ0IsZ0JBQzNEYSxFQUFBQSxFQUFBQSxTQUFvQlYsRUFBVUQsV0FBWSxjQUFlLGVBQ3pEWSxFQUFBQSxFQUFBQSxvQkFBbUJYLEVBQVVILGNBQzdCYyxFQUFBQSxFQUFBQSxvQkFBbUJYLEVBQVVELGFBQzdCYSxFQUFBQSxFQUFBQSxTQUF1QlosRUFBVUgsWUFBYSxnQkE4QmhELFdBQ0UsTUFBTUUsRUFBYTFELFNBQVNDLGNBQWMsZ0JBRTFDeUQsRUFBV2MsaUJBQWlCLFNBQVVDLElBQ3BDLEdBQUlDLElBRUYsWUFEQTNELFFBQVFDLElBQUksbUJBR2QsSUFBSUUsRUFBT3VELEVBQUVFLE9BQ2IsR0FBSXpELEVBQUtYLFVBQVVxRSxTQUFTLGNBQWUsQ0FDekMsSUFBSXBGLEVBQU1xRixPQUFPM0QsRUFBS0UsUUFBUTVCLEtBQzFCQyxFQUFNb0YsT0FBTzNELEVBQUtFLFFBQVEzQixLQUc5QixHQUZBc0IsUUFBUUMsSUFBSyxrQkFBaUIyQyxFQUFVWCxPQUFPRSxnQkFBZ0IxRCxFQUFLQyxNQUNwRXNCLFFBQVFDLElBQUkyQyxFQUFVRyxnQkFBa0JILEVBQVVYLFFBQzlDVyxFQUFVRyxnQkFBa0JILEVBQVVYLFNBQVdXLEVBQVVLLFVBQVlMLEVBQVVYLE9BQU9FLGdCQUFnQjFELEVBQUtDLEdBRy9HLEdBRkFzQixRQUFRQyxJQUFJeEIsRUFBS0MsR0FDakJrRSxFQUFVWCxPQUFPRCxPQUFPWSxFQUFVRSxNQUFPckUsRUFBS0MsR0FDSyxRQUEvQ2tFLEVBQVVELFdBQVc1RCxZQUFZTixFQUFLQyxHQUFnQixFQUN4RFosRUFBQUEsRUFBQUEsdUJBQ0FpRyxFQUFBQSxFQUFBQSxTQUFVbkIsRUFBVUQsV0FBWSxjQUFlbEUsRUFBS0MsRUFBSyxPQUN6RCxJQUFJc0YsRUFBVXBCLEVBQVVELFdBQVdwQyxXQUFXOUIsR0FBS0MsR0FLbkQsR0FKQXNCLFFBQVFDLElBQUkrRCxHQUNSQSxFQUFReEMsVUF1QnRCLFNBQW9CaEIsR0FDbEIsSUFBSXlELEVBQWdCekQsRUFBS2dDLGVBQ3pCLElBQUssSUFBSXBCLEVBQUksRUFBR0EsRUFBSTZDLEVBQWMxRixPQUFRNkMsSUFBSyxDQUM3Q3BCLFFBQVFDLElBQUlnRSxFQUFjN0MsR0FBRzNDLElBQUt3RixFQUFjN0MsR0FBRzFDLEtBQ3hDTyxTQUFTQyxjQUFlLHlCQUF3QitFLEVBQWM3QyxHQUFHM0MsbUJBQW1Cd0YsRUFBYzdDLEdBQUcxQyxTQUMzRzJCLFFBQVFJLFNBQVdELEVBQUtsQyxJQUMvQixDQUNGLENBN0JZNEYsQ0FBV0YsR0FFVEwsSUFFRixZQURBM0QsUUFBUUMsSUFBSSxrQkFHaEIsS0FBMEQsU0FBL0MyQyxFQUFVRCxXQUFXNUQsWUFBWU4sRUFBS0MsTUFDL0NOLEVBQUFBLEVBQUFBLGtCQUNBMkYsRUFBQUEsRUFBQUEsU0FBVW5CLEVBQVVELFdBQVksY0FBZWxFLEVBQUtDLEVBQUssUUFFekR5RixJQUNBdkIsRUFBVUksZUFHaEIsSUFFSixDQXBFRW9CLEdBQ0F4QixFQUFVSCxZQUFZWixlQUN0QjdCLFFBQVE4QixNQUFNYyxFQUFVRCxXQUFXbEIsZ0JBQ25DekIsUUFBUThCLE1BQU1jLEVBQVVELFdBQVdkLGdCQUNuQzdCLFFBQVE4QixNQUFNYyxFQUFVRCxXQUFXbEIsZUFDckMsQ0FFQSxTQUFTMEMsSUFDUCxJQUFJOUIsRUFBZ0JPLEVBQVVFLE1BQU1WLDRCQUNoQ2lDLEVBQWNsQixLQUFLbUIsTUFBTW5CLEtBQUtFLFNBQVdoQixFQUFjOUQsUUFDM0R5QixRQUFRQyxJQUFJb0UsR0FDWnJFLFFBQVFDLElBQUlvQyxHQUNaLElBQUksSUFBRTVELEVBQUcsSUFBRUMsR0FBUTJELEVBQWNrQyxPQUFPRixFQUFhLEdBQUcsR0FDeER6QixFQUFVRSxNQUFNZCxPQUFPWSxFQUFVWCxPQUFReEQsRUFBS0MsR0FDTSxRQUFoRGtFLEVBQVVILFlBQVkxRCxZQUFZTixFQUFLQyxLQUN6Q3FGLEVBQUFBLEVBQUFBLFNBQVVuQixFQUFVSCxZQUFhLGVBQWdCaEUsRUFBS0MsRUFBSyxRQUMzRFosRUFBQUEsRUFBQUEsc0JBQ0FrQyxRQUFRQyxJQUFJLGNBRVprRSxLQUN5RCxTQUFoRHZCLEVBQVVILFlBQVkxRCxZQUFZTixFQUFLQyxLQUNoRHNCLFFBQVFDLElBQUksZ0JBQ1o3QixFQUFBQSxFQUFBQSxrQkFDQTJGLEVBQUFBLEVBQUFBLFNBQVVuQixFQUFVSCxZQUFhLGVBQWdCaEUsRUFBS0MsRUFBSyxRQUMzRGtFLEVBQVVJLGdCQUVaaEQsUUFBUUMsSUFBSSxnQkFDZCxDQTJDQSxTQUFTMEQsSUFDUCxPQUFPZixFQUFVSCxZQUFZbEIsZ0JBQWtCcUIsRUFBVUQsV0FBV3BCLGNBQ3RFLG9NQ2hITyxTQUFTZ0MsRUFBbUI1RSxHQUNqQzZGLEVBQUFBLFFBQVNDLFNBQVN0RCxJQUNoQixJQUFJWCxHQUFPa0UsRUFBQUEsRUFBQUEsU0FBS3ZELEVBQVM3QyxLQUFNNkMsRUFBUzVDLFFBQ3BDb0csRUFBZSxJQUFLeEQsR0FDeEIsRUFBRyxDQUNELElBQUkxQyxFQUFNMEUsS0FBS21CLE1BQU1uQixLQUFLRSxVQUFZMUUsRUFBVW9CLFVBQVksR0FBSyxHQUM3RHJCLEVBQU15RSxLQUFLbUIsTUFBTW5CLEtBQUtFLFVBQVkxRSxFQUFVb0IsVUFBWSxHQUFLLEdBRTdEdkIsRUFEa0IyRSxLQUFLQyxNQUFNRCxLQUFLRSxVQUNGLGFBQWUsV0FDbkRzQixFQUFhbEcsSUFBTUEsRUFDbkJrRyxFQUFhakcsSUFBTUEsRUFDbkJpRyxFQUFhbkcsWUFBY0EsRUFDM0J3QixRQUFRQyxJQUFJMEUsRUFDZCxRQUFxRCxJQUE1Q2hHLEVBQVV1QyxVQUFVVixFQUFNbUUsR0FBdUIsR0FFOUQsQ0FDTyxTQUFTQyxFQUFhakcsRUFBV0YsRUFBS0MsR0FBTSxDQUM1QyxTQUFTbUcsRUFBY2xHLEVBQVdGLEVBQUtDLEdBQU0seU1DbkJoRG9HLEVBQTJCLENBQUMsRUFHaEMsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYUUsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJFLEdBQVksQ0FHakRHLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CTCxHQUFVSSxFQUFRQSxFQUFPRCxRQUFTSixHQUcvQ0ssRUFBT0QsT0FDZixDQ3JCQUosRUFBb0JPLEVBQUksQ0FBQ0gsRUFBU0ksS0FDakMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYUixFQUFvQlUsRUFBRUYsRUFBWUMsS0FBU1QsRUFBb0JVLEVBQUVOLEVBQVNLLElBQzVFRSxPQUFPQyxlQUFlUixFQUFTSyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JlLEVBQUksV0FDdkIsR0FBMEIsaUJBQWZDLFdBQXlCLE9BQU9BLFdBQzNDLElBQ0MsT0FBTzdELE1BQVEsSUFBSThELFNBQVMsY0FBYixFQUNoQixDQUFFLE1BQU90QyxHQUNSLEdBQXNCLGlCQUFYdUMsT0FBcUIsT0FBT0EsTUFDeEMsQ0FDQSxDQVB1QixHQ0F4QmxCLEVBQW9CVSxFQUFJLENBQUNTLEVBQUtDLElBQVVULE9BQU9VLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDQ2xGcEIsRUFBb0J3QixFQUFLcEIsSUFDSCxvQkFBWHFCLFFBQTBCQSxPQUFPQyxhQUMxQ2YsT0FBT0MsZUFBZVIsRUFBU3FCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RGhCLE9BQU9DLGVBQWVSLEVBQVMsYUFBYyxDQUFFdUIsT0FBTyxHQUFPLFFDTDlELElBQUlDLEVBQ0E1QixFQUFvQmUsRUFBRWMsZ0JBQWVELEVBQVk1QixFQUFvQmUsRUFBRWUsU0FBVyxJQUN0RixJQUFJNUgsRUFBVzhGLEVBQW9CZSxFQUFFN0csU0FDckMsSUFBSzBILEdBQWExSCxJQUNiQSxFQUFTNkgsZ0JBQ1pILEVBQVkxSCxFQUFTNkgsY0FBY0MsTUFDL0JKLEdBQVcsQ0FDZixJQUFJSyxFQUFVL0gsRUFBU2dJLHFCQUFxQixVQUM1QyxHQUFHRCxFQUFRekksT0FFVixJQURBLElBQUk2QyxFQUFJNEYsRUFBUXpJLE9BQVMsRUFDbEI2QyxHQUFLLElBQU11RixHQUFXQSxFQUFZSyxFQUFRNUYsS0FBSzJGLEdBRXhELENBSUQsSUFBS0osRUFBVyxNQUFNLElBQUlPLE1BQU0seURBQ2hDUCxFQUFZQSxFQUFVUSxRQUFRLE9BQVEsSUFBSUEsUUFBUSxRQUFTLElBQUlBLFFBQVEsWUFBYSxLQUNwRnBDLEVBQW9CcUMsRUFBSVQsbVdDUHhCekQsRUFBQUEsRUFBQUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2F1ZGlvL2F1ZGlvVXRpbHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9kYXRhL1NoaXBEYXRhLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvanMvRE9NL2FkZE1hcmtlck9uR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvanMvRE9NL2NyZWF0ZUdhbWVib2FyZEdyaWQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9qcy9ET00vcmVuZGVyU2hpcHNPbkdhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2pzL2ZhY3Rvcmllcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9qcy9mYWN0b3JpZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvanMvZmFjdG9yaWVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9qcy9nYW1lcGxheS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2pzL3V0aWxzL2dhbWVib2FyZFV0aWxzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBib29tU291bmQgZnJvbSAnLi9ib29tLm1wMyc7XG5pbXBvcnQgbWlzc1NvdW5kIGZyb20gJy4vbWlzcy1zb3VuZC5tcDMnO1xuZXhwb3J0IGZ1bmN0aW9uIHBsYXlFeHBsb3Npb25Tb3VuZCgpIHtcbiAgbGV0IGF1ZGlvID0gbmV3IEF1ZGlvKGJvb21Tb3VuZCk7XG4gIGF1ZGlvLnZvbHVtZSA9IDAuMjtcbiAgYXVkaW8ucGxheSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBsYXlNaXNzU291bmQoKSB7XG4gIGxldCBhdWRpbyA9IG5ldyBBdWRpbyhtaXNzU291bmQpO1xuICAvLyBhdWRpby52b2x1bWUgPSAwO1xuICBhdWRpby5wbGF5KCk7XG59XG4iLCJjb25zdCBTaGlwRGF0YSA9IFtcbiAge1xuICAgIG5hbWU6ICdjYXJyaWVyJyxcbiAgICBsZW5ndGg6IDUsXG4gICAgb3JpZW50YXRpb246IG51bGwsXG4gICAgcm93OiBudWxsLFxuICAgIGNvbDogbnVsbCxcbiAgfSxcbiAge1xuICAgIG5hbWU6ICdiYXR0bGVzaGlwJyxcbiAgICBsZW5ndGg6IDQsXG4gICAgb3JpZW50YXRpb246IG51bGwsXG4gICAgcm93OiBudWxsLFxuICAgIGNvbDogbnVsbCxcbiAgfSxcbiAge1xuICAgIG5hbWU6ICdjcnVpc2VyJyxcbiAgICBsZW5ndGg6IDMsXG4gICAgb3JpZW50YXRpb246IG51bGwsXG4gICAgcm93OiBudWxsLFxuICAgIGNvbDogbnVsbCxcbiAgfSxcbiAge1xuICAgIG5hbWU6ICdzdWJtYXJpbmUnLFxuICAgIGxlbmd0aDogMyxcbiAgICBvcmllbnRhdGlvbjogbnVsbCxcbiAgICByb3c6IG51bGwsXG4gICAgY29sOiBudWxsLFxuICB9LFxuICB7XG4gICAgbmFtZTogJ2Rlc3Ryb3llcicsXG4gICAgbGVuZ3RoOiAyLFxuICAgIG9yaWVudGF0aW9uOiBudWxsLFxuICAgIHJvdzogbnVsbCxcbiAgICBjb2w6IG51bGwsXG4gIH0sXG5dO1xuXG5leHBvcnQgZGVmYXVsdCBTaGlwRGF0YTtcbiIsImZ1bmN0aW9uIGFkZE1hcmtlcihnYW1lYm9hcmQsIGdhbWVib2FyZENsYXNzLCByb3csIGNvbCwgbWFya2VyKSB7XG4gIGxldCBoaXRJbmZvID0gZ2FtZWJvYXJkLmNlbGxIaXRJbmZvKHJvdywgY29sKTtcbiAgbGV0IGdhbWVib2FyZERPTSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2dhbWVib2FyZENsYXNzfWApO1xuICBsZXQgY2VsbERPTSA9IGdhbWVib2FyZERPTS5xdWVyeVNlbGVjdG9yKGAuY2VsbFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWApO1xuICBpZiAoaGl0SW5mbyAhPT0gZmFsc2UpIHtcbiAgICBsZXQgaGl0TWFya2VyID0gY3JlYXRlSGl0TWFya2VyKCk7XG4gICAgaGl0TWFya2VyLmNsYXNzTGlzdC5hZGQobWFya2VyKTtcbiAgICBjZWxsRE9NLmFwcGVuZENoaWxkKGhpdE1hcmtlcik7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlSGl0TWFya2VyKCkge1xuICAvLyBDcmVhdGUgYW4gU1ZHIGVsZW1lbnRcbiAgbGV0IHNpemUgPSAyMDsgLy8gcHhcbiAgY29uc3Qgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBgJHtzaXplfWApO1xuICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBgJHtzaXplfWApO1xuICBzdmcuY2xhc3NMaXN0LmFkZCgnaGl0LW1hcmtlcicpO1xuXG4gIC8vIENyZWF0ZSBhIGNpcmNsZSBlbGVtZW50XG4gIGNvbnN0IGNpcmNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnY2lyY2xlJyk7XG4gIGNpcmNsZS5zZXRBdHRyaWJ1dGUoJ2N4JywgYCR7c2l6ZSAvIDJ9YCk7XG4gIGNpcmNsZS5zZXRBdHRyaWJ1dGUoJ2N5JywgYCR7c2l6ZSAvIDJ9YCk7XG4gIGNpcmNsZS5zZXRBdHRyaWJ1dGUoJ3InLCBgJHtzaXplIC8gMn1gKTtcblxuICAvLyBBcHBlbmQgdGhlIGNpcmNsZSB0byB0aGUgU1ZHXG4gIHN2Zy5hcHBlbmRDaGlsZChjaXJjbGUpO1xuICByZXR1cm4gc3ZnO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhZGRNYXJrZXI7XG4iLCJmdW5jdGlvbiBjcmVhdGVHYW1lYm9hcmRHcmlkKGdhbWVib2FyZCwgZ2FtZWJvYXJkQ2xhc3MsIHBsYXllckNsYXNzKSB7XG4gIGxldCBnYW1lYm9hcmRTaXplID0gZ2FtZWJvYXJkLmdldFNpemUoKTtcbiAgY29uc29sZS5sb2coZ2FtZWJvYXJkQ2xhc3MpO1xuICBsZXQgc2VsZWN0ZWRHYW1lYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtnYW1lYm9hcmRDbGFzc31gKTtcbiAgY29uc29sZS5sb2coc2VsZWN0ZWRHYW1lYm9hcmQpO1xuICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBnYW1lYm9hcmRTaXplOyByb3crKykge1xuICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdhbWVib2FyZFNpemU7IGNvbCsrKSB7XG4gICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdjZWxsJyk7XG4gICAgICBjZWxsLmNsYXNzTGlzdC5hZGQocGxheWVyQ2xhc3MpO1xuICAgICAgY2VsbC5kYXRhc2V0LnJvdyA9IHJvdztcbiAgICAgIGNlbGwuZGF0YXNldC5jb2wgPSBjb2w7XG4gICAgICBzZWxlY3RlZEdhbWVib2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlR2FtZWJvYXJkR3JpZDtcbiIsImZ1bmN0aW9uIHJlbmRlclNoaXBzT25HYW1lQm9hcmQoZ2FtZWJvYXJkLCBnYW1lYm9hcmRDbGFzcykge1xuICBjb25zdCBzZWxlY3RlZEdhbWVib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2dhbWVib2FyZENsYXNzfWApO1xuXG4gIGNvbnN0IGdhbWVib2FyZFNpemUgPSBnYW1lYm9hcmQuZ2V0U2l6ZSgpO1xuICBjb25zdCBib2FyZCA9IGdhbWVib2FyZC5nZXRCb2FyZCgpO1xuICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBnYW1lYm9hcmRTaXplOyByb3crKykge1xuICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdhbWVib2FyZFNpemU7IGNvbCsrKSB7XG4gICAgICBsZXQgc2hpcCA9IGJvYXJkW3Jvd11bY29sXTtcbiAgICAgIGlmIChzaGlwICE9PSBudWxsKSB7XG4gICAgICAgIGxldCBjZWxsRE9NID0gc2VsZWN0ZWRHYW1lYm9hcmQucXVlcnlTZWxlY3RvcihgLmNlbGxbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gKTtcbiAgICAgICAgY2VsbERPTS5kYXRhc2V0LnNoaXBOYW1lID0gc2hpcC5uYW1lO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCByZW5kZXJTaGlwc09uR2FtZUJvYXJkO1xuIiwiZnVuY3Rpb24gR2FtZWJvYXJkKCkge1xuICBsZXQgYm9hcmRTaXplID0gMTA7XG4gIGxldCBib2FyZCA9IEFycmF5KGJvYXJkU2l6ZSlcbiAgICAuZmlsbCgpXG4gICAgLm1hcCgoKSA9PiBBcnJheShib2FyZFNpemUpLmZpbGwobnVsbCkpO1xuXG4gIGxldCBib2FyZEhpdHMgPSBBcnJheShib2FyZFNpemUpXG4gICAgLmZpbGwoKVxuICAgIC5tYXAoKCkgPT4gQXJyYXkoYm9hcmRTaXplKS5maWxsKGZhbHNlKSk7XG4gIGxldCBzaGlwcyA9IFtdO1xuXG4gIGZ1bmN0aW9uIGlzVmFsaWRTaGlwUGxhY2VtZW50KHNoaXBEYXRhKSB7XG4gICAgY29uc3QgeyBsZW5ndGgsIHJvdywgY29sLCBvcmllbnRhdGlvbiB9ID0gc2hpcERhdGE7XG4gICAgLy8gQ2hlY2sgaWYgdGhlIHNoaXAgcGxhY2VtZW50IGdvZXMgb3V0IG9mIGJvdW5kc1xuICAgIGlmICgob3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJyAmJiBjb2wgKyBsZW5ndGggPiBib2FyZFNpemUpIHx8IChvcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJyAmJiByb3cgKyBsZW5ndGggPiBib2FyZFNpemUpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIG92ZXJsYXBwaW5nIHNoaXBzXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGJvYXJkW3Jvd11bY29sICsgaV0gIT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAob3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGJvYXJkW3JvdyArIGldW2NvbF0gIT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlOyAvLyBUaGUgcGxhY2VtZW50IGlzIHZhbGlkXG4gIH1cblxuICByZXR1cm4ge1xuICAgIHJlY2VpdmVBdHRhY2socm93LCBjb2wpIHtcbiAgICAgIGlmIChib2FyZEhpdHNbcm93XVtjb2xdICE9PSBmYWxzZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgc2hpcCA9IGJvYXJkW3Jvd11bY29sXTtcbiAgICAgIGlmIChzaGlwICE9PSBudWxsKSB7XG4gICAgICAgIHNoaXAuaGl0KHJvdywgY29sKTtcbiAgICAgICAgYm9hcmRIaXRzW3Jvd11bY29sXSA9ICdoaXQnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYm9hcmRIaXRzW3Jvd11bY29sXSA9ICdtaXNzJztcbiAgICAgIH1cbiAgICB9LFxuICAgIHBsYWNlU2hpcChzaGlwLCBzaGlwRGF0YSkge1xuICAgICAgaWYgKGlzVmFsaWRTaGlwUGxhY2VtZW50KHNoaXBEYXRhKSkge1xuICAgICAgICBjb25zdCB7IHJvdywgY29sLCBuYW1lLCBsZW5ndGgsIG9yaWVudGF0aW9uIH0gPSBzaGlwRGF0YTtcblxuICAgICAgICBpZiAob3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGJvYXJkW3Jvd11bY29sICsgaV0gPSBzaGlwO1xuICAgICAgICAgICAgc2hpcHMucHVzaChzaGlwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAob3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBib2FyZFtyb3cgKyBpXVtjb2xdID0gc2hpcDtcbiAgICAgICAgICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgYWxsU2hpcHNTdW5rKCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoIXNoaXBzW2ldLmlzU3VuaygpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIC8vIGZpbGxCb2FyZFJhbmRvbWx5KHNoaXBEYXRhQXJyYXkpIHtcbiAgICAvLyAgIHNoaXBEYXRhQXJyYXkuZm9yRWFjaCgoc2hpcERhdGEpID0+IHt9KTtcbiAgICAvLyB9LFxuICAgIGdldFNpemUoKSB7XG4gICAgICByZXR1cm4gYm9hcmRTaXplO1xuICAgIH0sXG4gICAgZ2V0Qm9hcmQoKSB7XG4gICAgICAvLyByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShib2FyZCkpO1xuICAgICAgcmV0dXJuIGJvYXJkO1xuICAgIH0sXG4gICAgZ2V0Qm9hcmRIaXRzKCkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYm9hcmRIaXRzKSk7XG4gICAgfSxcbiAgICBjZWxsSGl0SW5mbyhyb3csIGNvbCkge1xuICAgICAgcmV0dXJuIGJvYXJkSGl0c1tyb3ddW2NvbF07XG4gICAgfSxcbiAgICBkaXNwbGF5Qm9hcmQoKSB7XG4gICAgICBjb25zb2xlLnRhYmxlKGJvYXJkKTtcbiAgICB9LFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBHYW1lYm9hcmQ7XG4iLCJmdW5jdGlvbiBQbGF5ZXIoZ2FtZWJvYXJkKSB7XG4gIGxldCBhdmFpbGFibGVIaXRzID0gQXJyYXkoZ2FtZWJvYXJkLmdldFNpemUoKSlcbiAgICAuZmlsbCgpXG4gICAgLm1hcCgoKSA9PiBBcnJheShnYW1lYm9hcmQuZ2V0U2l6ZSgpKS5maWxsKHRydWUpKTtcblxuICByZXR1cm4ge1xuICAgIGdhbWVib2FyZCxcbiAgICBhdHRhY2socGxheWVyLCByb3csIGNvbCkge1xuICAgICAgaWYgKHRoaXMuaGFzQXZhaWxhYmxlSGl0KHJvdywgY29sKSkge1xuICAgICAgICBsZXQgZW5lbXlHYW1lYm9hcmQgPSBwbGF5ZXIuZ2FtZWJvYXJkO1xuICAgICAgICBlbmVteUdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKHJvdywgY29sKTtcbiAgICAgICAgYXZhaWxhYmxlSGl0c1tyb3ddW2NvbF0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhhc0F2YWlsYWJsZUhpdChyb3csIGNvbCkge1xuICAgICAgcmV0dXJuIGF2YWlsYWJsZUhpdHNbcm93XVtjb2xdO1xuICAgIH0sXG4gICAgZ2V0UmVtYWluaW5nQXZhaWxhYmxlSGl0cygpIHtcbiAgICAgIGxldCByZW1haW5pbmdIaXRzID0gW107XG4gICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBhdmFpbGFibGVIaXRzLmxlbmd0aDsgcm93KyspIHtcbiAgICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgYXZhaWxhYmxlSGl0cy5sZW5ndGg7IGNvbCsrKSB7XG4gICAgICAgICAgaWYgKHRoaXMuaGFzQXZhaWxhYmxlSGl0KHJvdywgY29sKSkgcmVtYWluaW5nSGl0cy5wdXNoKHsgcm93LCBjb2wgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZW1haW5pbmdIaXRzO1xuICAgIH0sXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllcjtcbiIsImZ1bmN0aW9uIFNoaXAobmFtZSwgbGVuZ3RoKSB7XG4gIGxldCBoaXRzID0gMDtcbiAgbGV0IHBvc2l0aW9ucyA9IFtdO1xuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgbGVuZ3RoLFxuICAgIGhpdChyb3csIGNvbCkge1xuICAgICAgcG9zaXRpb25zLnB1c2goeyByb3csIGNvbCB9KTtcbiAgICAgIGhpdHMrKztcbiAgICB9LFxuICAgIGlzU3VuaygpIHtcbiAgICAgIGlmIChoaXRzID49IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgZ2V0UG9zaXRpb25zKCkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocG9zaXRpb25zKSk7XG4gICAgfSxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBjcmVhdGVHYW1lYm9hcmRHcmlkIGZyb20gJy4vRE9NL2NyZWF0ZUdhbWVib2FyZEdyaWQnO1xuaW1wb3J0IHsgcGxhY2VTaGlwc1JhbmRvbWx5IH0gZnJvbSAnLi91dGlscy9nYW1lYm9hcmRVdGlscyc7XG5pbXBvcnQgcmVuZGVyU2hpcHNPbkdhbWVCb2FyZCBmcm9tICcuL0RPTS9yZW5kZXJTaGlwc09uR2FtZWJvYXJkJztcbmltcG9ydCBhZGRNYXJrZXIgZnJvbSAnLi9ET00vYWRkTWFya2VyT25HYW1lYm9hcmQnO1xuaW1wb3J0IEdhbWVib2FyZCBmcm9tICcuL2ZhY3Rvcmllcy9HYW1lYm9hcmQnO1xuaW1wb3J0IFBsYXllciBmcm9tICcuL2ZhY3Rvcmllcy9QbGF5ZXInO1xuaW1wb3J0IHsgcGxheUV4cGxvc2lvblNvdW5kLCBwbGF5TWlzc1NvdW5kIH0gZnJvbSAnLi4vYXVkaW8vYXVkaW9VdGlscyc7XG5cbmNvbnN0IHBsYXllckJvYXJkID0gR2FtZWJvYXJkKCk7XG5jb25zdCBlbmVteUJvYXJkID0gR2FtZWJvYXJkKCk7XG5cbmNvbnN0IHBsYXllciA9IFBsYXllcihwbGF5ZXJCb2FyZCk7XG5jb25zdCBlbmVteSA9IFBsYXllcihlbmVteUJvYXJkKTtcblxuY29uc3QgZ2FtZVN0YXRlID0ge1xuICBwbGF5ZXJCb2FyZDogcGxheWVyQm9hcmQsXG4gIGVuZW15Qm9hcmQ6IGVuZW15Qm9hcmQsXG4gIHBsYXllcjogcGxheWVyLFxuICBlbmVteTogZW5lbXksXG4gIGN1cnJlbnRQbGF5ZXI6IG51bGwsIC8vIEluaXRpYWxpemUgd2l0aCB0aGUgcGxheWVyJ3MgdHVyblxuICBzd2l0Y2hQbGF5ZXIoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFBsYXllciA9PT0gdGhpcy5wbGF5ZXIpIHtcbiAgICAgIHRoaXMuY3VycmVudFBsYXllciA9IHRoaXMuZW5lbXk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IHRoaXMuZW5lbXkpIHtcbiAgICAgIHRoaXMuY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyO1xuICAgIH1cbiAgfSxcbiAgZ2FtZU92ZXI6IGZhbHNlLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVHYW1lKCkge1xuICBsZXQgdHVyblN0YXJ0ID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKTtcbiAgZ2FtZVN0YXRlLmN1cnJlbnRQbGF5ZXIgPSBnYW1lU3RhdGUucGxheWVyO1xuICAvLyBpZiAodHVyblN0YXJ0ID09PSAwKSB7XG4gIC8vICAgZ2FtZVN0YXRlLmN1cnJlbnRQbGF5ZXIgPSBnYW1lU3RhdGUucGxheWVyO1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIGdhbWVTdGF0ZS5jdXJyZW50UGxheWVyID0gZ2FtZVN0YXRlLmVuZW15O1xuICAvLyB9XG4gIGNyZWF0ZUdhbWVib2FyZEdyaWQoZ2FtZVN0YXRlLnBsYXllckJvYXJkLCAncGxheWVyLWJvYXJkJywgJ3BsYXllci1jZWxsJyk7XG4gIGNyZWF0ZUdhbWVib2FyZEdyaWQoZ2FtZVN0YXRlLmVuZW15Qm9hcmQsICdlbmVteS1ib2FyZCcsICdlbmVteS1jZWxsJyk7XG4gIHBsYWNlU2hpcHNSYW5kb21seShnYW1lU3RhdGUucGxheWVyQm9hcmQpO1xuICBwbGFjZVNoaXBzUmFuZG9tbHkoZ2FtZVN0YXRlLmVuZW15Qm9hcmQpO1xuICByZW5kZXJTaGlwc09uR2FtZUJvYXJkKGdhbWVTdGF0ZS5wbGF5ZXJCb2FyZCwgJ3BsYXllci1ib2FyZCcpO1xuICBhY3RpdmF0ZUVuZW15Q2VsbHMoKTtcbiAgZ2FtZVN0YXRlLnBsYXllckJvYXJkLmRpc3BsYXlCb2FyZCgpO1xuICBjb25zb2xlLnRhYmxlKGdhbWVTdGF0ZS5lbmVteUJvYXJkLmdldEJvYXJkSGl0cygpKTtcbiAgY29uc29sZS50YWJsZShnYW1lU3RhdGUuZW5lbXlCb2FyZC5kaXNwbGF5Qm9hcmQoKSk7XG4gIGNvbnNvbGUudGFibGUoZ2FtZVN0YXRlLmVuZW15Qm9hcmQuZ2V0Qm9hcmRIaXRzKCkpO1xufVxuXG5mdW5jdGlvbiBlbmVteUF0dGFjaygpIHtcbiAgbGV0IHJlbWFpbmluZ0hpdHMgPSBnYW1lU3RhdGUuZW5lbXkuZ2V0UmVtYWluaW5nQXZhaWxhYmxlSGl0cygpO1xuICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZW1haW5pbmdIaXRzLmxlbmd0aCk7XG4gIGNvbnNvbGUubG9nKHJhbmRvbUluZGV4KTtcbiAgY29uc29sZS5sb2cocmVtYWluaW5nSGl0cyk7XG4gIGxldCB7IHJvdywgY29sIH0gPSByZW1haW5pbmdIaXRzLnNwbGljZShyYW5kb21JbmRleCwgMSlbMF07XG4gIGdhbWVTdGF0ZS5lbmVteS5hdHRhY2soZ2FtZVN0YXRlLnBsYXllciwgcm93LCBjb2wpO1xuICBpZiAoZ2FtZVN0YXRlLnBsYXllckJvYXJkLmNlbGxIaXRJbmZvKHJvdywgY29sKSA9PT0gJ2hpdCcpIHtcbiAgICBhZGRNYXJrZXIoZ2FtZVN0YXRlLnBsYXllckJvYXJkLCAncGxheWVyLWJvYXJkJywgcm93LCBjb2wsICdoaXQnKTtcbiAgICBwbGF5RXhwbG9zaW9uU291bmQoKTtcbiAgICBjb25zb2xlLmxvZygnRU5FTVkgSElUIScpO1xuICAgIC8vIHNldFRpbWVvdXQoZW5lbXlBdHRhY2ssIDEwMDApO1xuICAgIGVuZW15QXR0YWNrKCk7XG4gIH0gZWxzZSBpZiAoZ2FtZVN0YXRlLnBsYXllckJvYXJkLmNlbGxIaXRJbmZvKHJvdywgY29sKSA9PT0gJ21pc3MnKSB7XG4gICAgY29uc29sZS5sb2coJ0VORU1ZIE1JU1MhJyk7XG4gICAgcGxheU1pc3NTb3VuZCgpO1xuICAgIGFkZE1hcmtlcihnYW1lU3RhdGUucGxheWVyQm9hcmQsICdwbGF5ZXItYm9hcmQnLCByb3csIGNvbCwgJ21pc3MnKTtcbiAgICBnYW1lU3RhdGUuc3dpdGNoUGxheWVyKCk7XG4gIH1cbiAgY29uc29sZS5sb2coJ0VORU1ZIEFUVEFDSyEnKTtcbn1cblxuZnVuY3Rpb24gYWN0aXZhdGVFbmVteUNlbGxzKCkge1xuICBjb25zdCBlbmVteUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmVuZW15LWJvYXJkJyk7XG5cbiAgZW5lbXlCb2FyZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgaWYgKGdhbWVJc1dvbigpKSB7XG4gICAgICBjb25zb2xlLmxvZygnR0FNRSBJUyBPVkVSISEhJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBjZWxsID0gZS50YXJnZXQ7XG4gICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbmVteS1jZWxsJykpIHtcbiAgICAgIGxldCByb3cgPSBOdW1iZXIoY2VsbC5kYXRhc2V0LnJvdyk7XG4gICAgICBsZXQgY29sID0gTnVtYmVyKGNlbGwuZGF0YXNldC5jb2wpO1xuICAgICAgY29uc29sZS5sb2coYGF2YWlsYWJsZSBoaXQ6ICR7Z2FtZVN0YXRlLnBsYXllci5oYXNBdmFpbGFibGVIaXQocm93LCBjb2wpfWApO1xuICAgICAgY29uc29sZS5sb2coZ2FtZVN0YXRlLmN1cnJlbnRQbGF5ZXIgPT09IGdhbWVTdGF0ZS5wbGF5ZXIpO1xuICAgICAgaWYgKGdhbWVTdGF0ZS5jdXJyZW50UGxheWVyID09PSBnYW1lU3RhdGUucGxheWVyICYmICFnYW1lU3RhdGUuZ2FtZU92ZXIgJiYgZ2FtZVN0YXRlLnBsYXllci5oYXNBdmFpbGFibGVIaXQocm93LCBjb2wpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJvdywgY29sKTtcbiAgICAgICAgZ2FtZVN0YXRlLnBsYXllci5hdHRhY2soZ2FtZVN0YXRlLmVuZW15LCByb3csIGNvbCk7XG4gICAgICAgIGlmIChnYW1lU3RhdGUuZW5lbXlCb2FyZC5jZWxsSGl0SW5mbyhyb3csIGNvbCkgPT09ICdoaXQnKSB7XG4gICAgICAgICAgcGxheUV4cGxvc2lvblNvdW5kKCk7XG4gICAgICAgICAgYWRkTWFya2VyKGdhbWVTdGF0ZS5lbmVteUJvYXJkLCAnZW5lbXktYm9hcmQnLCByb3csIGNvbCwgJ2hpdCcpO1xuICAgICAgICAgIGxldCBoaXRTaGlwID0gZ2FtZVN0YXRlLmVuZW15Qm9hcmQuZ2V0Qm9hcmQoKVtyb3ddW2NvbF07XG4gICAgICAgICAgY29uc29sZS5sb2coaGl0U2hpcCk7XG4gICAgICAgICAgaWYgKGhpdFNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIHJldmVhbFNoaXAoaGl0U2hpcCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChnYW1lSXNXb24oKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0dBTUUgSVMgT1ZFUiEhIScpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChnYW1lU3RhdGUuZW5lbXlCb2FyZC5jZWxsSGl0SW5mbyhyb3csIGNvbCkgPT09ICdtaXNzJykge1xuICAgICAgICAgIHBsYXlNaXNzU291bmQoKTtcbiAgICAgICAgICBhZGRNYXJrZXIoZ2FtZVN0YXRlLmVuZW15Qm9hcmQsICdlbmVteS1ib2FyZCcsIHJvdywgY29sLCAnbWlzcycpO1xuICAgICAgICAgIC8vIHNldFRpbWVvdXQoZW5lbXlBdHRhY2ssIDEwMDApO1xuICAgICAgICAgIGVuZW15QXR0YWNrKCk7XG4gICAgICAgICAgZ2FtZVN0YXRlLnN3aXRjaFBsYXllcigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2FtZUlzV29uKCkge1xuICByZXR1cm4gZ2FtZVN0YXRlLnBsYXllckJvYXJkLmFsbFNoaXBzU3VuaygpIHx8IGdhbWVTdGF0ZS5lbmVteUJvYXJkLmFsbFNoaXBzU3VuaygpO1xufVxuXG5mdW5jdGlvbiByZXZlYWxTaGlwKHNoaXApIHtcbiAgbGV0IHNoaXBQb3NpdGlvbnMgPSBzaGlwLmdldFBvc2l0aW9ucygpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBQb3NpdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zb2xlLmxvZyhzaGlwUG9zaXRpb25zW2ldLnJvdywgc2hpcFBvc2l0aW9uc1tpXS5jb2wpO1xuICAgIGxldCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmVuZW15LWNlbGxbZGF0YS1yb3c9XCIke3NoaXBQb3NpdGlvbnNbaV0ucm93fVwiXVtkYXRhLWNvbD1cIiR7c2hpcFBvc2l0aW9uc1tpXS5jb2x9XCJdYCk7XG4gICAgY2VsbC5kYXRhc2V0LnNoaXBOYW1lID0gc2hpcC5uYW1lO1xuICB9XG59XG4iLCJpbXBvcnQgU2hpcERhdGEgZnJvbSAnLi4vLi4vZGF0YS9TaGlwRGF0YSc7XG5pbXBvcnQgU2hpcCBmcm9tICcuLi9mYWN0b3JpZXMvU2hpcCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBwbGFjZVNoaXBzUmFuZG9tbHkoZ2FtZWJvYXJkKSB7XG4gIFNoaXBEYXRhLmZvckVhY2goKHNoaXBEYXRhKSA9PiB7XG4gICAgbGV0IHNoaXAgPSBTaGlwKHNoaXBEYXRhLm5hbWUsIHNoaXBEYXRhLmxlbmd0aCk7XG4gICAgbGV0IHNoaXBEYXRhQ29weSA9IHsgLi4uc2hpcERhdGEgfTtcbiAgICBkbyB7XG4gICAgICBsZXQgcm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGdhbWVib2FyZC5nZXRTaXplKCkgLSAwKSArIDApO1xuICAgICAgbGV0IGNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChnYW1lYm9hcmQuZ2V0U2l6ZSgpIC0gMCkgKyAwKTtcbiAgICAgIGxldCBvcmllbnRhdGlvbkJvb2wgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkpO1xuICAgICAgbGV0IG9yaWVudGF0aW9uID0gb3JpZW50YXRpb25Cb29sID8gJ2hvcml6b250YWwnIDogJ3ZlcnRpY2FsJztcbiAgICAgIHNoaXBEYXRhQ29weS5yb3cgPSByb3c7XG4gICAgICBzaGlwRGF0YUNvcHkuY29sID0gY29sO1xuICAgICAgc2hpcERhdGFDb3B5Lm9yaWVudGF0aW9uID0gb3JpZW50YXRpb247XG4gICAgICBjb25zb2xlLmxvZyhzaGlwRGF0YUNvcHkpO1xuICAgIH0gd2hpbGUgKGdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcCwgc2hpcERhdGFDb3B5KSAhPT0gdHJ1ZSk7XG4gIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZEhpdE1hcmtlcihnYW1lYm9hcmQsIHJvdywgY29sKSB7fVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1pc3NNYXJrZXIoZ2FtZWJvYXJkLCByb3csIGNvbCkge31cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICFzY3JpcHRVcmwpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybDsiLCJpbXBvcnQgYWRkTWFya2VyIGZyb20gJy4vanMvRE9NL2FkZE1hcmtlck9uR2FtZWJvYXJkJztcbmltcG9ydCBjcmVhdGVHYW1lYm9hcmRHcmlkIGZyb20gJy4vanMvRE9NL2NyZWF0ZUdhbWVib2FyZEdyaWQnO1xuaW1wb3J0IHJlbmRlclNoaXBzT25HYW1lQm9hcmQgZnJvbSAnLi9qcy9ET00vcmVuZGVyU2hpcHNPbkdhbWVib2FyZCc7XG5pbXBvcnQgR2FtZWJvYXJkIGZyb20gJy4vanMvZmFjdG9yaWVzL0dhbWVib2FyZCc7XG5pbXBvcnQgUGxheWVyIGZyb20gJy4vanMvZmFjdG9yaWVzL1BsYXllcic7XG5pbXBvcnQgU2hpcCBmcm9tICcuL2pzL2ZhY3Rvcmllcy9TaGlwJztcbmltcG9ydCB7IGluaXRpYWxpemVHYW1lIH0gZnJvbSAnLi9qcy9nYW1lcGxheSc7XG5pbXBvcnQgeyBwbGFjZVNoaXBzUmFuZG9tbHkgfSBmcm9tICcuL2pzL3V0aWxzL2dhbWVib2FyZFV0aWxzJztcblxuaW1wb3J0ICcvc3JjL2Nzcy9zdHlsZXMuY3NzJztcblxuaW5pdGlhbGl6ZUdhbWUoKTtcbiJdLCJuYW1lcyI6WyJwbGF5RXhwbG9zaW9uU291bmQiLCJhdWRpbyIsIkF1ZGlvIiwiYm9vbVNvdW5kIiwidm9sdW1lIiwicGxheSIsInBsYXlNaXNzU291bmQiLCJtaXNzU291bmQiLCJuYW1lIiwibGVuZ3RoIiwib3JpZW50YXRpb24iLCJyb3ciLCJjb2wiLCJnYW1lYm9hcmQiLCJnYW1lYm9hcmRDbGFzcyIsIm1hcmtlciIsImhpdEluZm8iLCJjZWxsSGl0SW5mbyIsImNlbGxET00iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJoaXRNYXJrZXIiLCJzaXplIiwic3ZnIiwiY3JlYXRlRWxlbWVudE5TIiwic2V0QXR0cmlidXRlIiwiY2xhc3NMaXN0IiwiYWRkIiwiY2lyY2xlIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVIaXRNYXJrZXIiLCJwbGF5ZXJDbGFzcyIsImdhbWVib2FyZFNpemUiLCJnZXRTaXplIiwiY29uc29sZSIsImxvZyIsInNlbGVjdGVkR2FtZWJvYXJkIiwiY2VsbCIsImNyZWF0ZUVsZW1lbnQiLCJkYXRhc2V0IiwiYm9hcmQiLCJnZXRCb2FyZCIsInNoaXAiLCJzaGlwTmFtZSIsImJvYXJkU2l6ZSIsIkFycmF5IiwiZmlsbCIsIm1hcCIsImJvYXJkSGl0cyIsInNoaXBzIiwicmVjZWl2ZUF0dGFjayIsImhpdCIsInBsYWNlU2hpcCIsInNoaXBEYXRhIiwiaSIsImlzVmFsaWRTaGlwUGxhY2VtZW50IiwicHVzaCIsImFsbFNoaXBzU3VuayIsImlzU3VuayIsImdldEJvYXJkSGl0cyIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsImRpc3BsYXlCb2FyZCIsInRhYmxlIiwiYXZhaWxhYmxlSGl0cyIsImF0dGFjayIsInBsYXllciIsInRoaXMiLCJoYXNBdmFpbGFibGVIaXQiLCJnZXRSZW1haW5pbmdBdmFpbGFibGVIaXRzIiwicmVtYWluaW5nSGl0cyIsImhpdHMiLCJwb3NpdGlvbnMiLCJnZXRQb3NpdGlvbnMiLCJwbGF5ZXJCb2FyZCIsIkdhbWVib2FyZCIsImVuZW15Qm9hcmQiLCJnYW1lU3RhdGUiLCJQbGF5ZXIiLCJlbmVteSIsImN1cnJlbnRQbGF5ZXIiLCJzd2l0Y2hQbGF5ZXIiLCJnYW1lT3ZlciIsImluaXRpYWxpemVHYW1lIiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwiY3JlYXRlR2FtZWJvYXJkR3JpZCIsInBsYWNlU2hpcHNSYW5kb21seSIsInJlbmRlclNoaXBzT25HYW1lQm9hcmQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImdhbWVJc1dvbiIsInRhcmdldCIsImNvbnRhaW5zIiwiTnVtYmVyIiwiYWRkTWFya2VyIiwiaGl0U2hpcCIsInNoaXBQb3NpdGlvbnMiLCJyZXZlYWxTaGlwIiwiZW5lbXlBdHRhY2siLCJhY3RpdmF0ZUVuZW15Q2VsbHMiLCJyYW5kb21JbmRleCIsImZsb29yIiwic3BsaWNlIiwiU2hpcERhdGEiLCJmb3JFYWNoIiwiU2hpcCIsInNoaXBEYXRhQ29weSIsImFkZEhpdE1hcmtlciIsImFkZE1pc3NNYXJrZXIiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJ3aW5kb3ciLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwibG9jYXRpb24iLCJjdXJyZW50U2NyaXB0Iiwic3JjIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiRXJyb3IiLCJyZXBsYWNlIiwicCJdLCJzb3VyY2VSb290IjoiIn0=